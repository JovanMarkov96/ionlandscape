# Ion Landscape Technical Guide

**Version**: 1.0.0
**Last Updated**: January 2026

## 1. Project Overview

Ion Landscape is an interactive map and academic family tree for trapped-ion and neutral-atom quantum computing research groups. It visualizes the relationships, locations, and lineages of researchers in the field.

The project is built as a **static site** using Docusaurus, with a completely **self-hosted mapping stack** to ensure longevity, privacy, and zero reliance on external paid APIs (like Google Maps or Mapbox).

---

## 2. Architecture & Tech Stack

### Frontend
- **Framework**: [Docusaurus](https://docusaurus.io/) (React-based static site generator).
- **Map Engine**: [MapLibre GL JS](https://maplibre.org/) (Open-source fork of Mapbox GL JS).
- **Vector Tiles**: [PMTiles](https://github.com/protomaps/PMTiles) (Cloud-native, single-file tile archive).
- **Styling**: Custom CSS variables with Dark Mode support.

### Data Pipeline
- **Source of Truth**: Markdown files in `content/people/` (Frontmatter + Biography).
- **Processing**: Python scripts (`scripts/build_index.py`) convert Markdown -> JSON/GeoJSON.
- **Map Data**:
    - **Base Map**: [OpenFreeMap](https://openfreemap.org/) (Planet-wide vector tiles).
    - **Custom Overlay**: `serbia.pmtiles` (Generated locally to provided accurate administrative boundaries for the Serbian worldview).

### Deployment
- **Hosting**: GitHub Pages.
- **CI/CD**: GitHub Actions builds and pushes the static artifacts.

---

## 3. The Map System

The map is the core component (`src/components/MapPanel.jsx`). It has migrated from Leaflet to MapLibre GL JS to support vector tiles and better performance.

### 3.1. Tile Sources
1.  **OpenFreeMap (`openmaptiles`)**:
    -   Serves standard OSM planet vector tiles.
    -   Used for the majority of the world map (background, water, roads).
2.  **Local Overlay (`local-tiles`)**:
    -   Source: `static/map/serbia.pmtiles`.
    -   Purpose: Overlays specific administrative boundaries (Kosovo as part of Serbia) to meet project requirements.
    -   Format: PMTiles (served as a static file range-requested by the browser).

### 3.2. Styling
-   **Themes**: Light and Dark modes are supported natively.
-   **Style Logic**: `createStyle(isDark)` in `MapPanel.jsx` dynamically generates the Mapbox Style Specification JSON based on the current Docusaurus theme.

### 3.3. Interaction
-   **Markers**: Dynamically looking at `people.geojson`.
-   **Popups**: Custom HTML popups with "Open profile" buttons that link to researcher pages.
-   **Grouping**: Researchers at the exact same coordinate are grouped into a single popup.

---

## 4. Tile Generation Pipeline

To produce the custom `serbia.pmtiles` overlay, we use a local generation pipeline found in `tile-generation/`.

### 4.1. Requirements
-   **OS**: Windows (PowerShell) or Linux.
-   **Tools**: `tilemaker.exe` and `pmtiles.exe` (Automated download via script).

### 4.2. Workflow
The script `generate-tiles.ps1` performs the following:
1.  **Downloads Tools**: Fetches `tilemaker` and `pmtiles` binaries if missing.
2.  **Downloads Data**: Fetches `serbia-latest.osm.pbf` from Geofabrik.
3.  **Process**:
    -   Uses `tilemaker` with `config.json` and a custom `process.lua`.
    -   **Lua Script**: Detects Kosovo boundary relations and forcefully downgrades them from `admin_level=2` (Country) to `admin_level=4` (Region), effectively merging it into Serbia for the map view.
4.  **Convert**: Converts the intermediate `.mbtiles` to an optimized `.pmtiles` archive.
5.  **Deploy**: Copies the result to `website/static/map/serbia.pmtiles`.

### 4.3. Usage
Developers must run this manually if they need to update the map boundaries:
```powershell
cd tile-generation
.\generate-tiles.ps1
```

---

## 5. Data Structures

### 5.1. People Data (`content/people/*.md`)
Each researcher has a Markdown file with frontmatter:
```yaml
name: "Vladan Vuletić"
institution: "MIT"
location: "Cambridge, MA, USA"
search_keywords: "neutral atoms, quantum computing"
website: "http://..."
coordinate: [42.3601, -71.0942] # Lat, Lon
# Relations
mentors:
  - "Theodor W. Hänsch"
  - "Wolfgang Ketterle"
students: []
```

### 5.2. Generated Index (`website/static/data/people.geojson`)
Generated by `scripts/build_index.py`. This is what the Map and Groups page consume.

---

## 6. Developer Guide

### 6.1. Setup
1.  **Python Env** (for data scripts):
    ```bash
    python -m venv .venv
    .venv\Scripts\activate
    pip install -r scripts/requirements.txt
    ```
2.  **Node Env** (for website):
    ```bash
    cd website
    npm install
    ```

### 6.2. Running Locally
```bash
# Terminal 1: Build Data (if markdown changed)
python scripts/build_index.py

# Terminal 2: Run Website
cd website
npm start
```

### 6.3. Updating the Map Boundary
If you need to regenerate the Serbia overlay:
1.  Navigate to `tile-generation/`.
2.  Run `.\generate-tiles.ps1`.
3.  Commit the new `website/static/map/serbia.pmtiles`.

### 6.4. Deployment
Pushing to the `main` branch triggers the GitHub Action.
**Note**: Large files rule. `serbia.pmtiles` is small enough (<50MB) to be committed directly. The raw `.osm.pbf` and `tilemaker.exe` are ignored via `.gitignore` and must be downloaded locally using the script.
